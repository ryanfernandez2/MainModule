name: Build and Deploy
env:
  OUTPUT_PATH: ${{ github.workspace }}\.output
  DOTNET_VERSION: "3.1.*"
  # FUNCTION_NAME: "ImageResizeTask" # moved inside jobs to work with matrices

on:
  # Change to pull_request and 'main'
  push:
    branches:
      - main

jobs:
  tenantprep:
    runs-on: ubuntu-latest
    outputs:
      config: ${{ steps.set-matrix.outputs.config }}
    steps:
      - uses: actions/checkout@v2
      - id: set-matrix
        run: |
          TASKS=$(echo $(cat .github/workflows/StagingList.json) | sed 's/ //g')
          echo "::set-output name=config::$TASKS"

  testenv:
    runs-on: windows-latest
    strategy:
      matrix: ${{ fromJson(needs.tenantprep.outputs.config) }}
    environment: ${{ matrix.environment }}
    steps:
    - name: Run Pester
      shell: pwsh
      run: echo "Hello"

  